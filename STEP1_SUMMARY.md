## 실습 환경 구축
* [QnA](https://github.com/next-step/jwp-qna) 저장소를 기반으로 미션을 진행한다. [온라인 코드 리뷰 요청 1단계](https://github.com/next-step/nextstep-docs/blob/master/codereview/review-step1.md) 문서를 참고해 실습 환경을 구축한다.
* 미션 시작 버튼을 눌러 미션을 시작한다.
* 저장소에 자신의 GitHub 아이디로 된 브랜치가 생성되었는지 확인한다.
* 저장소를 자신의 계정으로 Fork 한다.

## 요구사항
##### QnA 서비스를 만들어가면서 JPA로 실제 도메인 모델을 어떻게 구성하고 객체와 테이블을 어떻게 매핑해야 하는지 알아본다.

* 아래의 DDL(Data Definition Language)을 보고 유추하여 엔티티 클래스와 리포지토리 클래스를 작성해 본다.
* ```@DataJpaTest```를 사용하여 학습 테스트를 해 본다.

```sql
create table answer
(
    id          bigint generated by default as identity,
    contents    clob,
    created_at  timestamp not null,
    deleted     boolean   not null,
    question_id bigint,
    updated_at  timestamp,
    writer_id   bigint,
    primary key (id)
)
```
```sql
create table delete_history
(
    id            bigint generated by default as identity,
    content_id    bigint,
    content_type  varchar(255),
    create_date   timestamp,
    deleted_by_id bigint,
    primary key (id)
)
```
```sql
create table question
(
    id         bigint generated by default as identity,
    contents   clob,
    created_at timestamp    not null,
    deleted    boolean      not null,
    title      varchar(100) not null,
    updated_at timestamp,
    writer_id  bigint,
    primary key (id)
)
```
```sql
create table user
(
    id         bigint generated by default as identity,
    created_at timestamp   not null,
    email      varchar(50),
    name       varchar(20) not null,
    password   varchar(20) not null,
    updated_at timestamp,
    user_id    varchar(20) not null,
    primary key (id)
)

alter table user
    add constraint UK_a3imlf41l37utmxiquukk8ajc unique (user_id)
```

***

## 엔티티 매핑 내용 정리
### 기본 키 매핑 방법 
#### 직접 할당
* `@Id` 어노테이션만 사용.

#### 자동 생성
* `@Id`와 `@GenerateValue` 어노테이션을 함께 사용.
* 자동 생성 전략 : `@GenerateValue`의 속성 값 `strategy`에 아래 전략 중 하나를 세팅한다.
    - `IDENTIRY` : 테이터 베이스에 위임.
    - `SEQUENCE` : 데이터베이스의 시퀀스 오브젝트를 사용. 
    - `TABLE` : 시퀀스 생성 테이블을 생성하여 사용.

### 자동 생성 전략별 사용법 및 특징
* IDENTIRY
    - 특징 
        + 기본 키 생성을 데이터베이스에 위임하여 INSERT 전까지는 ID를 사용자가 알 수 없음.
        + 이와같은 이유로 인해 `Transaction Commit`시에 SQL을 실행하는것이 아니라 `persist(save)`시에 쿼리가 실행된다.
        + 대표적인 예가 `MySql`의 `AUTO_INCREMENT`가 있다.

* SEQUENCE
    - 특징
        + 유일한 값을 순서대로 생성하는 데이터베이스의 오브젝트를 사용한다.
        + 대표적인 예가 `Oracle`의 `Oracel Sequence`이다.
        + `persist(save)`시점에 `SEQUENCE`값만 조회해 온다.(`Transaction Commit` 시 `INSERT` 쿼리가 실행된다.)
        + `allocationSize` 속성은 1 이상의 값으로 지정될 경우 한번 조회 해 올 때 지정된 값 만큼 다음 시퀀스 범위를 조회해 오고 메모리에 둔 상태로 시퀀스를 꺼내사용하여 성능 최적화에 사용된다.(기본값 50)
    - 사용방법
        + 클래스에 `@SequenceGenerator` 어노테이션을 달고 제네레이터의 이름, 시퀀스 이름, 초기화값, 한번에 호출 증가수 값 등을 지정한다.(주요 속성으로는 `name`, `sequenceName`, `initialValue`, `allocationSize` 등이 있다.)
        + `@GenerateValue`의 `generator` 값을 `@SequenceGenerator` 어노테이션의 `name` 값과 일치시킨다.

* TABLE
    - 특징
        + 키 생성용 테이블을 만들어서 데이터베이스의 시퀀스와 비슷한 기능을 구현.
        + 모든 데이터베이스에 적용이 가능하나 성능적인 문제가 따라온다.
    - 사용방법
        + 클래스에 `@TableGenerator` 어노테이션을 달고 제네레이터의 이름, 테이블 이름, PK컬럼 이름, 한번에 호출 증가수 값 등을 지정한다.(주요 속성으로는 `name`, `table`, `pkColumnValue`, `allocationSize`, `initialValue` 등이 있다.)
        + `@GenerateValue`의 `generator` 값을 `@TableGenerator` 어노테이션의 `name` 값과 일치시킨다.

- 출처 : [김영한의 자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic/dashboard)


### 메소드 이름 쿼리 생성 규칙
- 시작 키워드

키워드 | 예시 | SQL
---|---|---
`findBy...` | `findBy`Name(String name) | select * from table where name = 'name'
`deleteBy...` | `deleteBy`Name(String name) | delete from table where name = 'name'
`countBy...` | `countBy`Age(int age) | select count(*) from table where age = 'age'

등이 있음.

- 쿼리 조건자 키워드(Query predicate keywords) - 주요 항목 몇개만 예시로 남김.
        
키워드 | 예시 | SQL
---|---|---
`And` | findByName`And`Age(String name, int age) | name = 'name' **`AND`** age = 'age'
`Or` | findByName`Or`Age(String name, int age) | name = 'name' **`OR`** age = 'age' 
`StartingWith` | findByName`StartingWith`(String text) | name `like` 'text`%`' 
`EndingWith`   | findByName`EndingWith`(String text) | name `like` '`%`text'
`Containing`   | findByName`Containing`(String text) | name `like` '`%`text`%`'
`In` | findByType`In`(Collection\<Type\> types) | type `in` (?, ?, ... ?) 
`Between` | findByAgeBetween(int start, int end) | age between `start` and `end`
`OrderBy...Asc` | findAll`OrderBy`Age`Asc`() | `order by` age `asc`
`OrderBy...Desc` | findAll`OrderBy`Age`Desc`() | `order by` age `desc`

등이 있음.

- 출처 : https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords
